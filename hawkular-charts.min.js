angular.module("hawkular.charts",[]);var Charts;!function(t){"use strict";var e=angular.module("hawkular.charts"),n=function(){function t(t){this.value=t}return t.prototype.toString=function(){return this.value},t.UP="up",t.DOWN="down",t.UNKNOWN="unknown",t}();t.AvailStatus=n;var a=function(){function t(t,e,n,a,r,i,o){this.start=t,this.end=e,this.value=n,this.startDate=a,this.endDate=r,this.duration=i,this.message=o,this.duration=moment(e).from(moment(t),!0),this.startDate=new Date(t),this.endDate=new Date(e)}return t}();t.TransformedAvailDataPoint=a;var r=function(){function e(r){var i=this;this.restrict="E",this.replace=!0,this.scope={data:"=",startTimestamp:"@",endTimestamp:"@",timeLabel:"@",dateLabel:"@",noDataLabel:"@",chartTitle:"@"},this.link=function(o,s,u){function c(t){return"<div class='chartHover'>\n        <div>\n        <small>\n          <span class='chartHoverLabel'>Status: </span><span>: </span>\n          <span class='chartHoverValue'>"+t.value.toUpperCase()+"</span>\n        </small>\n        </div>\n          <div>\n          <small>\n            <span class='chartHoverLabel'>Duration</span><span>: </span>\n            <span class='chartHoverValue'>"+t.duration+"</span>\n          </small>\n          </div>\n        </div>"}function l(){D&&L.selectAll("*").remove(),L=d3.select(s[0]),D=L.append("svg").attr("viewBox","0 0 760 150").attr("preserveAspectRatio","xMinYMin meet"),H=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return c(t)}),R=D.append("g").attr("width",M+_.left+_.right).attr("height",B).attr("transform","translate("+_.left+","+U+")"),R.append("defs").append("pattern").attr("id","diagonal-stripes").attr("patternUnits","userSpaceOnUse").attr("patternTransform","scale(0.7)").attr("width",4).attr("height",4).append("path").attr("d","M-1,1 l2,-2 M0,4 l4,-4 M3,5 l2,-2").attr("stroke","#B6B6B6").attr("stroke-width",1.2),R.call(H)}function d(t){var e=[];E=+u.startTimestamp||d3.min(t,function(t){return t.start})||+moment().subtract(1,"hour"),t&&t.length>0&&(e[0]=E,e[1]=+moment(),y=d3.scale.linear().clamp(!0).rangeRound([70,0]).domain([0,175]),w=d3.svg.axis().scale(y).ticks(0).tickSize(0,0).orient("left"),A=d3.time.scale().range([0,M]).domain(e),C=d3.svg.axis().scale(A).tickSize(-70,0).orient("top").tickFormat(d3.time.format.multi([[".%L",function(t){return t.getMilliseconds()}],[":%S",function(t){return t.getSeconds()}],["%H:%M",function(t){return t.getMinutes()}],["%H:%M",function(t){return t.getHours()}],["%a %d",function(t){return t.getDay()&&1!=t.getDate()}],["%b %d",function(t){return 1!=t.getDate()}],["%B",function(t){return t.getMonth()}],["%Y",function(){return!0}]])))}function f(t){return t.value===n.UP.toString()}function m(t){return t.value===n.UNKNOWN.toString()}function p(t){function e(t,e){return t.timestamp<e.timestamp?-1:t.timestamp>e.timestamp?1:0}var r=[],i=t.length;if(t.sort(e),t&&i>0&&t[0].timestamp){var o=(new Date).getTime();if(1===i){var s=t[0];r.push(new a(o-36e5,s.timestamp,n.UNKNOWN.toString())),r.push(new a(s.timestamp,o,s.value))}else for(var u=o,c=t.length;c>0;c--){if(E>=t[c-1].timestamp){r.push(new a(E,u,t[c-1].value));break}r.push(new a(t[c-1].timestamp,u,t[c-1].value)),u=t[c-1].timestamp}}return r}function h(){R.append("text").attr("class","availUpLabel").attr("x",-10).attr("y",25).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Up"),R.append("text").attr("class","availDownLabel").attr("x",-10).attr("y",55).style("font-family","Arial, Verdana, sans-serif;").style("font-size","12px").attr("fill","#999").style("text-anchor","end").text("Down")}function v(t){function e(t){return V-o(0)+(f(t)||m(t)?0:35)}function n(t){return o(0)-(m(t)?15:50)}function a(t){return f(t)?"#54A24E":m(t)?"url(#diagonal-stripes)":"#D85054"}var r=(d3.min(t,function(t){return+t.start}),d3.max(t,function(t){return+t.end})),i=d3.time.scale().range([0,M]).domain([E,r]),o=d3.scale.linear().clamp(!0).range([V,0]).domain([0,4]);d3.svg.axis().scale(i).ticks(8).tickSize(13,0).orient("top");R.selectAll("rect.availBars").data(t).enter().append("rect").attr("class","availBars").attr("x",function(t){return i(+t.start)}).attr("y",function(t){return e(t)}).attr("height",function(t){return n(t)}).attr("width",function(t){return i(+t.end)-i(+t.start)}).attr("fill",function(t){return a(t)}).attr("opacity",function(){return.85}).on("mouseover",function(t,e){H.show(t,e)}).on("mouseout",function(){H.hide()}).on("mousedown",function(){var t=R.select(".brush").node(),e=new Event("mousedown");e.pageX=d3.event.pageX,e.clientX=d3.event.clientX,e.pageY=d3.event.pageY,e.clientY=d3.event.clientY,t.dispatchEvent(e)}).on("mouseup",function(){var t=R.select(".brush").node(),e=new Event("mouseup");e.pageX=d3.event.pageX,e.clientX=d3.event.clientX,e.pageY=d3.event.pageY,e.clientY=d3.event.clientY,t.dispatchEvent(e)}),R.append("line").attr("x1",0).attr("y1",70).attr("x2",655).attr("y2",70).attr("stroke-width",.5).attr("stroke","#D0D0D0"),h()}function g(){R.selectAll("g.axis").remove(),k=R.append("g").attr("class","x axis").call(C),R.append("g").attr("class","y axis").call(w)}function x(){function e(){R.classed("selecting",!0)}function n(){var e=b.extent(),n=Math.round(e[0].getTime()),a=Math.round(e[1].getTime()),i=a-n;i>=6e4&&(console.log("Drag: AvailTimeRangeChanged:"+e),r.$broadcast(t.EventNames.AVAIL_CHART_TIMERANGE_CHANGED.toString(),e)),T.call(b.clear())}b=d3.svg.brush().x(A).on("brushstart",e).on("brushend",n),T=R.append("g").attr("class","brush").call(b),T.selectAll(".resize").append("path"),T.selectAll("rect").attr("height",70)}var y,A,w,C,k,b,T,H,D,L,R,E=+u.startTimestamp,S=+u.endTimestamp,N=e._CHART_HEIGHT,_=(u.noDataLabel||"No Data",{top:10,right:5,bottom:5,left:90}),M=e._CHART_WIDTH-_.left-_.right,I=N-50,V=I-_.top-_.bottom,$=30,G=10,B=V+_.top-$-G,U=+$+G+_.top;o.$watchCollection("data",function(t){console.log("Avail Chart Data Changed"),t&&(i.transformedDataPoints=p(angular.fromJson(t)),o.render(i.transformedDataPoints))}),o.$watchGroup(["startTimestamp","endTimestamp"],function(t){console.log("Avail Chart Start/End Timestamp Changed"),E=t[0]||E,S=t[1]||S,o.render(i.transformedDataPoints)}),o.render=function(t){console.log("Starting Avail Chart Directive Render"),t&&t.length>0&&(console.group("Render Avail Chart"),console.time("availChartRender"),l(),d(t),g(),x(),v(t),console.timeEnd("availChartRender"),console.groupEnd())}}}return e.Factory=function(){var t=function(t){return new e(t)};return t.$inject=["$rootScope"],t},e._CHART_HEIGHT=150,e._CHART_WIDTH=750,e}();t.AvailabilityChartDirective=r,e.directive("availabilityChart",r.Factory())}(Charts||(Charts={}));var Charts;!function(t){"use strict";var e=angular.module("hawkular.charts"),n=function(){function e(n){var a=this;this.restrict="E",this.replace=!0,this.scope={data:"=",showYAxisValues:"="},this.link=function(r,i,o){function s(){A&&w.selectAll("*").remove(),w=d3.select(i[0]),A=w.append("svg").attr("width",T+k.left+k.right).attr("height",D).attr("viewBox","0 0 760 70").attr("preserveAspectRatio","xMinYMin meet"),C=A.append("g").attr("transform","translate("+k.left+", 0)")}function u(t){console.log("dataPoints.length: "+t.length),h=d3.time.scale().range([0,T-10]).nice().domain([t[0].timestamp,t[t.length-1].timestamp]),v=d3.svg.axis().scale(h).ticks(10).tickSize(4,0).orient("bottom"),C.selectAll("g.axis").remove(),g=C.append("g").attr("class","x axis").attr("transform","translate(0,"+H+")").call(v);var n=d3.min(t,function(t){return t.avg}),a=d3.max(t,function(t){return t.avg});a+=.03*a,n-=.05*n,f=d3.scale.linear().rangeRound([e._CHART_HEIGHT-10,0]).nice().domain([n,a]);var r=d?2:0;m=d3.svg.axis().scale(f).ticks(r).tickSize(4,0).orient("left"),p=C.append("g").attr("class","y axis").call(m);var i=d3.svg.area().interpolate("cardinal").defined(function(t){return!t.empty}).x(function(t){return h(t.timestamp)}).y0(function(t){return H}).y1(function(t){return f(t.avg)}),o=d3.svg.line().interpolate("cardinal").defined(function(t){return!t.empty}).x(function(t){return h(t.timestamp)}).y(function(t){return f(t.avg)}),s=C.selectAll("path.contextLine").data([t]);s.attr("class","contextLine").transition().attr("d",o),s.enter().append("path").attr("class","contextLine").transition().attr("d",o),s.exit().remove();var u=C.append("g").attr("class","context");u.append("path").datum(t).transition().duration(500).attr("class","contextArea").attr("d",i)}function c(){function e(){C.classed("selecting",!0)}function a(){var e=x.extent(),a=Math.round(e[0].getTime()),r=Math.round(e[1].getTime()),i=r-a;i>=6e4&&(console.log("Drag: ContextChartTimeRangeChanged:"+e),n.$broadcast(t.EventNames.CONTEXT_CHART_TIMERANGE_CHANGED.toString(),e))}x=d3.svg.brush().x(h).on("brushstart",e).on("brushend",a),g.append("g").selectAll("rect").attr("y",0).attr("height",H-10),y=C.append("g").attr("class","brush").call(x),y.selectAll(".resize").append("path"),y.selectAll("rect").attr("height",85)}function l(t){return t?t.map(function(t){var e=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:e,value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}var d,f,m,p,h,v,g,x,y,A,w,C,k={top:10,right:5,bottom:5,left:90},b=e._CHART_HEIGHT,T=e._CHART_WIDTH-k.left-k.right,H=b-k.top-k.bottom,D=H+k.top;"undefined"!=typeof o.showYAxisValues&&(d="true"===o.showYAxisValues),r.$watchCollection("data",function(t){console.log("Context Chart Data Changed"),t&&(a.dataPoints=l(angular.fromJson(t)),r.render(a.dataPoints))}),r.render=function(t){t&&t.length>0&&(console.group("Render Context Chart"),console.time("contextChartRender"),s(),u(t),c(),console.timeEnd("contextChartRender"),console.groupEnd())}}}return e.Factory=function(){var t=function(t){return new e(t)};return t.$inject=["$rootScope"],t},e._CHART_WIDTH=750,e._CHART_HEIGHT=80,e}();t.ContextChartDirective=n,e.directive("hawkularContextChart",n.Factory())}(Charts||(Charts={}));var Charts;!function(t){"use strict";var e=function(){function t(t){this.value=t}return t.prototype.toString=function(){return this.value},t.CHART_TIMERANGE_CHANGED=new t("ChartTimeRangeChanged"),t.AVAIL_CHART_TIMERANGE_CHANGED=new t("AvailChartTimeRangeChanged"),t.CONTEXT_CHART_TIMERANGE_CHANGED=new t("ContextChartTimeRangeChanged"),t}();t.EventNames=e}(Charts||(Charts={}));var Charts;!function(t){"use strict";var e=!1,n=10,a=25,r=function(){function t(t,e,n){this.startTimestamp=t,this.endTimestamp=e,this.alertValue=n,this.startDate=new Date(t),this.endDate=new Date(e)}return t}();angular.module("hawkular.charts").directive("hawkularChart",["$rootScope","$http","$interval","$log",function(i,o,s,u){function c(c,l,d){function f(t){return st(t.timestamp)}function m(){return bt}function p(){return m()<=ee}function h(){pt&&ht.selectAll("*").remove(),ht=d3.select(l[0]),pt=ht.append("svg").attr("viewBox","0 0 760 "+(kt+a)).attr("preserveAspectRatio","xMinYMin meet"),T(pt),vt=pt.append("g").attr("width",Zt+qt.left+qt.right).attr("height",re).attr("transform","translate("+qt.left+","+ie+")"),lt=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t,e){return b(t,e)}),vt.call(lt),vt.append("g").attr("class","alertHolder"),se=!0}function v(t){t&&(yt=d3.max(t.map(function(t){return C(t)?0:t.avg||t.value})),At=d3.min(t.map(function(t){return C(t)?void 0:t.avg||t.value}))),gt=Kt?0:.95*At,xt=yt+.2*(yt-At),_t&&(xt=Math.max(xt,1.2*_t),gt=Math.min(gt,.95*_t)),xt=xt||gt?xt:n}function g(t){var e,n=20;t.length>0&&(p()?(Zt=250,e=3,nt=t.slice(t.length-n,t.length)):(e=9,nt=t),v(t),at=function(){return Zt/nt.length-oe},rt=function(t){return 0===t||t===nt.length-1?at()/2:at()},it=function(t,e){return st(t.timestamp)-(0===e?0:at()/2)},ot=d3.scale.linear().clamp(!0).rangeRound([te,0]).domain([gt,xt]),ut=d3.svg.axis().scale(ot).ticks(5).tickSize(4,4,0).orient("left"),st=d3.time.scale().range([0,Zt]).domain(d3.extent(nt,function(t){return t.timestamp})),mt=d3.time.scale().range([0,Zt]).domain(d3.extent(nt,function(t){return t.timestamp})),ct=d3.svg.axis().scale(st).ticks(e).tickFormat(d3.time.format("%H:%M")).tickSize(4,4,0).orient("bottom"))}function x(t){function e(){var e,n,a,r,i=[],o=[];return t.forEach(function(t){e=d3.max(t.values.map(function(t){return C(t)?0:t.avg})),i.push(e),n=d3.min(t.values.map(function(t){return C(t)?Number.MAX_VALUE:t.avg})),o.push(n)}),a=d3.max(i),r=d3.min(o),[r,a]}var a,r,i=e();return yt=i[1],At=i[0],gt=Kt?0:At-.05*At,_t?(a=1.2*_t,r=yt+.2*(yt-At),xt=a>r?a:r):xt=yt+.2*(yt-At),[gt,xt||gt?xt:n]}function y(t){var e=9;if(t&&t[0]&&t[0].values){var n=x(t);gt=n[0],xt=n[1],ot=d3.scale.linear().clamp(!0).rangeRound([te,0]).domain([gt,xt]),ut=d3.svg.axis().scale(ot).ticks(5).tickSize(4,4,0).orient("left"),st=d3.time.scale().range([0,Zt]).domain([d3.min(t,function(t){return d3.min(t.values,function(t){return t.timestamp})}),d3.max(t,function(t){return d3.max(t.values,function(t){return t.timestamp})})]),ct=d3.svg.axis().scale(st).ticks(e).tickFormat(d3.time.format("%H:%M")).tickSize(4,4,0).orient("bottom")}}function A(t,e,n,a,r){void 0===r&&(r=60);var i={headers:{"Hawkular-Tenant":Rt},params:{start:n,end:a,buckets:r}};if(n>=a&&u.log("Start date was after end date"),t&&Et&&e){var s=Et.split("-");o.get(t+"/"+s[0]+"s/"+e+"/"+(s[1]||"data"),i).success(function(t){wt=w(t),c.render(wt,Ct)}).error(function(t,e){u.error("Error Loading Chart Data:"+e+", "+t)})}}function w(t){return t?t.map(function(t){var e=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:e,date:new Date(e),value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}function C(t){return t.empty}function k(t){return"undefined"==typeof t.avg}function b(t,e){var n,a,r,i=t.timestamp,o=moment(t.timestamp).format(Tt);return e>0&&(a=nt[e-1].timestamp,r=moment(i).from(moment(a),!0)),n=C(t)?"<div class='chartHover'>\n                <small class='chartHoverLabel'>"+Yt+"</small>\n                <div><small><span class='chartHoverLabel'>"+Pt+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                <hr/>\n                <div><small><span class='chartHoverLabel'>"+Ot+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                </div>":k(t)?"<div class='chartHover'>\n                <div><small><span class='chartHoverLabel'>"+Ot+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span></small></div>\n                  <div><small><span class='chartHoverLabel'>"+Pt+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small></div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+Ut+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.value,2)+"</span></small> </div>\n                  </div> ":"<div class='chartHover'>\n                <small>\n                  <span class='chartHoverLabel'>"+Ot+"</span><span>: </span><span class='chartHoverValue'>"+o+"</span>\n                </small>\n                  <div><small><span class='chartHoverLabel'>"+Pt+"</span><span>: </span><span class='chartHoverValue'>"+r+"</span></small> </div>\n                  <hr/>\n                  <div><small><span class='chartHoverLabel'>"+zt+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.max,2)+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+Xt+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.avg,2)+"</span></small> </div>\n                  <div><small><span class='chartHoverLabel'>"+Ft+"</span><span>: </span><span class='chartHoverValue'>"+d3.round(t.min,2)+"</span></small> </div>\n                  </div> "}function T(t){var e=t.append("defs");e.append("pattern").attr("id","noDataStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").append("path").attr("d","M 0 0 6 0").attr("style","stroke:#CCCCCC; fill:none;"),e.append("pattern").attr("id","unknownStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#2E9EC2; fill:none;").append("path").attr("d","M 0 0 6 0"),e.append("pattern").attr("id","downStripes").attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","6").attr("height","3").attr("style","stroke:#ff8a9a; fill:none;").append("path").attr("d","M 0 0 6 0")}function H(t){function e(e){e.attr("class",n).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}).transition().attr("x",function(t,e){return it(t,e)}).attr("width",function(t,e){return rt(e)}).attr("y",function(t){return C(t)?0:ot(t.avg)}).attr("height",function(t){return te-ot(C(t)?ot(xt):t.avg)}).attr("opacity",t?".6":"1").attr("fill",function(e,n){return C(e)?"url(#noDataStripes)":t?"#D3D3D6":"#C0C0C0"}).attr("stroke",function(t){return"#777"}).attr("stroke-width",function(t){return"0"}).attr("data-hawkular-value",function(t){return t.avg})}var n=t?"leaderBar":"histogram",a=vt.selectAll("rect."+n).data(nt);a.call(e),a.enter().append("rect").call(e),a.exit().remove(),jt?vt.selectAll(".histogramTopStem, .histogramBottomStem, .histogramTopCross, .histogramBottomCross").remove():_(t)}function D(t){t.attr("class",function(t){return t.min===t.max?"singleValue":"high"}).attr("x",function(t,e){return it(t,e)}).attr("y",function(t){return ot(isNaN(t.max)?gt:t.max)}).attr("height",function(t){return C(t)?0:ot(t.avg)-ot(t.max)||2}).attr("width",function(t,e){return rt(e)}).attr("opacity",.9).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()})}function L(t){t.attr("class","low").attr("x",function(t,e){return it(t,e)}).attr("y",function(t){return isNaN(t.avg)?te:ot(t.avg)}).attr("height",function(t){return C(t)?0:ot(t.min)-ot(t.avg)}).attr("width",function(t,e){return rt(e)}).attr("opacity",.9).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()})}function R(t){t.attr("class","histogramTopStem").filter(function(t){return!C(t)}).attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return ot(t.max)}).attr("y2",function(t){return ot(t.avg)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(t){return ce})}function E(t){t.filter(function(t){return!C(t)}).attr("class","histogramBottomStem").attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return ot(t.avg)}).attr("y2",function(t){return ot(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-opacity",function(t){return ce})}function S(t){t.filter(function(t){return!C(t)}).attr("class","histogramTopCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return ot(t.max)}).attr("y2",function(t){return ot(t.max)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(t){return ce})}function N(t){t.filter(function(t){return!C(t)}).attr("class","histogramBottomCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return ot(t.min)}).attr("y2",function(t){return ot(t.min)}).attr("stroke",function(t){return"red"}).attr("stroke-width",function(t){return"0.5"}).attr("stroke-opacity",function(t){return ce})}function _(t){if(t){var e=vt.selectAll("rect.high, rect.singleValue").data(nt);e.call(D),e.enter().append("rect").call(D),e.exit().remove();var n=vt.selectAll("rect.low").data(nt);n.call(L),n.enter().append("rect").call(L),n.exit().remove()}else{var a=vt.selectAll(".histogramTopStem").data(nt);a.call(R),a.enter().append("line").call(R),a.exit().remove();var r=vt.selectAll(".histogramBottomStem").data(nt);r.call(E),r.enter().append("line").call(E),r.exit().remove();var i=vt.selectAll(".histogramTopCross").data(nt);i.call(S),i.enter().append("line").call(S),i.exit().remove();var o=vt.selectAll(".histogramBottomCross").data(nt);o.call(N),o.enter().append("line").call(N),o.exit().remove()}}function M(){var t=d3.svg.line().interpolate(Mt).defined(function(t){return!C(t)}).x(function(t){return st(t.timestamp)}).y(function(t){return ot(k(t)?t.value:t.avg)}),e=vt.selectAll("path.metricLine").data([nt]);e.attr("class","metricLine").transition().attr("d",t),e.enter().append("path").attr("class","metricLine").transition().attr("d",t),e.exit().remove()}function I(t){var e=d3.scale.category10(),n=0;t?(vt.selectAll("path[id^='multiLine']")[0].forEach(function(e){var n=!1;t.forEach(function(t){t.keyHash=t.keyHash||"multiLine"+tt(t.key),e.getAttribute("id")===t.keyHash&&(n=!0)}),n||e.remove()}),t.forEach(function(t){if(t&&t.values){t.keyHash=t.keyHash||"multiLine"+tt(t.key);var a=vt.selectAll("path#"+t.keyHash).data([t.values]);a.attr("id",t.keyHash).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color||e(n++)}).transition().attr("d",P("linear")),a.enter().append("path").attr("id",t.keyHash).attr("class","multiLine").attr("fill","none").attr("stroke",function(){return t.color?t.color:e(n++)}).transition().attr("d",P("linear")),a.exit().remove()}})):u.warn("No multi-data set for multiline chart")}function V(){var t=d3.svg.area().interpolate(Mt).defined(function(t){return!C(t)}).x(function(t){return f(t)}).y(function(t){return ot(k(t)?t.value:t.max)}).y0(function(t){return ot(k(t)?t.value:t.avg)}),e=d3.svg.area().interpolate(Mt).defined(function(t){return!C(t)}).x(function(t){return f(t)}).y(function(t){return ot(k(t)?t.value:t.avg)}).y0(function(t){return jt?te:ot(t.min)}),n=d3.svg.area().interpolate(Mt).defined(function(t){return!C(t)}).x(function(t){return f(t)}).y(function(t){return ot(k(t)?t.value:t.min)}).y0(function(){return te});if(!jt){var a=vt.selectAll("path.highArea").data([nt]);a.attr("class","highArea").attr("d",t),a.enter().append("path").attr("class","highArea").attr("d",t),a.exit().remove();var r=vt.selectAll("path.lowArea").data([nt]);r.attr("class","lowArea").attr("d",n),r.enter().append("path").attr("class","lowArea").attr("d",n),r.exit().remove()}var i=vt.selectAll("path.avgArea").data([nt]);i.attr("class","avgArea").transition().attr("d",e),i.enter().append("path").attr("class","avgArea").transition().attr("d",e),i.exit().remove()}function $(){if(jt)vt.selectAll(".highDot, .lowDot").remove();else{var t=vt.selectAll(".highDot").data(nt);t.attr("class","highDot").filter(function(t){return!C(t)}).attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return ot(k(t)?t.value:t.max)}).style("fill",function(){return"#ff1a13"}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),t.enter().append("circle").filter(function(t){return!C(t)}).attr("class","highDot").attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return ot(k(t)?t.value:t.max)}).style("fill",function(){return"#ff1a13"}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),t.exit().remove();var e=vt.selectAll(".lowDot").data(nt);e.attr("class","lowDot").filter(function(t){return!C(t)}).attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return ot(k(t)?t.value:t.min)}).style("fill",function(){return"#70c4e2"}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),e.enter().append("circle").filter(function(t){return!C(t)}).attr("class","lowDot").attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return ot(k(t)?t.value:t.min)}).style("fill",function(){return"#70c4e2"}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),e.exit().remove()}var n=vt.selectAll(".avgDot").data(nt);n.attr("class","avgDot").filter(function(t){return!C(t)}).attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return ot(k(t)?t.value:t.avg)}).style("fill",function(){return"#FFF"}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),n.enter().append("circle").filter(function(t){return!C(t)}).attr("class","avgDot").attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return ot(k(t)?t.value:t.avg)}).style("fill",function(){return"#FFF"}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),n.exit().remove()}function G(){var t=vt.selectAll(".scatterLineTopStem").data(nt);t.attr("class","scatterLineTopStem").filter(function(t){return!C(t)}).attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return ot(t.max)}).attr("y2",function(t){return ot(t.avg)}).attr("stroke",function(t){return"#000"}),t.enter().append("line").filter(function(t){return!C(t)}).attr("class","scatterLineTopStem").attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return ot(t.max)}).attr("y2",function(t){return ot(t.avg)}).attr("stroke",function(t){return"#000"}),t.exit().remove();var e=vt.selectAll(".scatterLineBottomStem").data(nt);e.attr("class","scatterLineBottomStem").filter(function(t){return!C(t)}).attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return ot(t.avg)}).attr("y2",function(t){return ot(t.min)}).attr("stroke",function(t){return"#000"}),e.enter().append("line").filter(function(t){return!C(t)}).attr("class","scatterLineBottomStem").attr("x1",function(t){return f(t)}).attr("x2",function(t){return f(t)}).attr("y1",function(t){return ot(t.avg)}).attr("y2",function(t){return ot(t.min)}).attr("stroke",function(t){return"#000"}),e.exit().remove();var n=vt.selectAll(".scatterLineTopCross").data(nt);n.attr("class","scatterLineTopCross").filter(function(t){return!C(t)}).attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return ot(t.max)}).attr("y2",function(t){return ot(t.max)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),n.enter().append("line").filter(function(t){return!C(t)}).attr("class","scatterLineTopCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return ot(t.max)}).attr("y2",function(t){return ot(t.max)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),n.exit().remove();var a=vt.selectAll(".scatterLineBottomCross").data(nt);a.attr("class","scatterLineBottomCross").filter(function(t){return!C(t)}).attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return ot(t.min)}).attr("y2",function(t){return ot(t.min)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),a.enter().append("line").filter(function(t){return!C(t)}).attr("class","scatterLineBottomCross").attr("x1",function(t){return f(t)-3}).attr("x2",function(t){return f(t)+3}).attr("y1",function(t){return ot(t.min)}).attr("y2",function(t){return ot(t.min)}).attr("stroke",function(t){return"#000"}).attr("stroke-width",function(t){return"0.5"}),a.exit().remove();var r=vt.selectAll(".scatterDot").data(nt);r.attr("class","scatterDot").filter(function(t){return!C(t)}).attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return ot(k(t)?t.value:t.avg)}).style("fill",function(){return"#70c4e2"}).style("opacity",function(){return"1"}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),r.enter().append("circle").filter(function(t){return!C(t)}).attr("class","scatterDot").attr("r",3).attr("cx",function(t){return f(t)}).attr("cy",function(t){return ot(k(t)?t.value:t.avg)}).style("fill",function(){return"#70c4e2"}).style("opacity",function(){return"1"}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),r.exit().remove()}function B(){if(ot){var t=vt.selectAll("g.grid.y_grid");t[0].length||(t=vt.append("g").classed("grid y_grid",!0)),t.call(d3.svg.axis().scale(ot).orient("left").ticks(10).tickSize(-Zt,0).tickFormat(""))}}function U(){function t(t){t.transition().delay(500).duration(2e3).attr("opacity",1)}if(ut){vt.selectAll("g.axis").remove();vt.append("g").attr("class","x axis").attr("transform","translate(0,"+te+")").attr("opacity",.3).call(ct).call(t),vt.append("g").attr("class","y axis").attr("opacity",.3).call(ut).call(t),vt.append("text").attr("class","yAxisUnitsLabel").attr("transform","rotate(-90),translate(-10,-50)").attr("x",-kt/2).style("text-anchor","start").text("NONE"===d.yAxisUnits?"":d.yAxisUnits).attr("opacity",.3).call(t)}}function Y(t){var e=t||"monotone",n=d3.svg.line().interpolate(e).defined(function(t){return!C(t)}).x(function(t){return st(t.timestamp)}).y(function(t){return ot(k(t)?t.value:t.avg)});return n}function P(t){var e=t||"monotone",n=d3.svg.line().interpolate(e).defined(function(t){return!C(t)}).x(function(t){return st(t.timestamp)}).y(function(t){return ot(k(t)?t.value:t.avg)});return n}function F(){if("bar"===Bt||"scatterline"===Bt){var t=vt.selectAll(".barAvgLine").data([nt]);t.attr("class","barAvgLine").attr("d",Y("monotone")),t.enter().append("path").attr("class","barAvgLine").attr("d",Y("monotone")),t.exit().remove()}}function z(t){var e=d3.svg.line().interpolate("monotone").x(function(t){return st(t.timestamp)}).y(function(e){return ot(t)});return e}function X(t){var e=vt.selectAll("path.alertLine").data([nt]);e.attr("class","alertLine").attr("d",z(t)),e.enter().append("path").attr("class","alertLine").attr("d",z(t)),e.exit().remove()}function O(t,e){function n(t,e){var n,a=[];return t.forEach(function(r,i){0===i&&r.avg>e?a.push(i):(n=t[i-1],r.avg>e&&n&&(!n.avg||n.avg<=e)&&a.push(n.avg?i-1:i))}),a}function a(e,n){var a,i,o,s=[];return e.forEach(function(e){o=t[e];for(var u=e;u<t.length-1;u++)if(a=t[u],i=t[u+1],a.avg>n&&i.avg<=n||a.avg>n&&!i.avg){s.push(new r(o.timestamp,i.avg?i.timestamp:a.timestamp,n));break}}),s.length===e.length-1&&s.push(new r(t[e[e.length-1]].timestamp,t[t.length-1].timestamp,n)),s}var i,o;return o=n(t,e),i=a(o,e)}function W(t){function e(t){t.attr("class","alertBounds").attr("x",function(t){return st(t.startTimestamp)}).attr("y",function(){return ot(xt)}).attr("height",function(t){return 185}).attr("width",function(t){return st(t.endTimestamp)-st(t.startTimestamp)})}var n=vt.select("g.alertHolder").selectAll("rect.alertBounds").data(t);n.call(e),n.enter().append("rect").call(e),n.exit().remove()}function J(){function e(){vt.classed("selecting",!0)}function n(){var e=dt.extent(),n=Math.round(e[0].getTime()),a=Math.round(e[1].getTime()),r=a-n;vt.classed("selecting",!d3.event.target.empty()),r>=6e4&&i.$broadcast(t.EventNames.CHART_TIMERANGE_CHANGED.toString(),e),ft.call(dt.clear())}ft=vt.selectAll("g.brush"),ft.empty()&&(ft=vt.append("g").attr("class","brush")),dt=d3.svg.brush().x(st).on("brushstart",e).on("brushend",n),ft.call(dt),ft.selectAll(".resize").append("path"),ft.selectAll("rect").attr("height",te)}function j(t){t&&vt.append("path").datum(t).attr("class","prevRangeAvgLine").style("stroke-dasharray","9,3").attr("d",Y("linear"))}function K(t){t&&vt.selectAll(".annotationDot").data(t).enter().append("circle").attr("class","annotationDot").attr("r",5).attr("cx",function(t){return st(t.timestamp)}).attr("cy",function(){return te-ot(xt)}).style("fill",function(t){return"1"===t.severity?"red":"2"===t.severity?"yellow":"white"})}function q(t){var e=1,n=vt.selectAll(".dataPointDot").data(t);n.attr("class","dataPointDot").attr("r",e).attr("cx",function(t){return st(t.timestamp)}).attr("cy",function(t){return t.avg?ot(t.avg):-9999999}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),n.enter().append("circle").attr("class","dataPointDot").attr("r",e).attr("cx",function(t){return st(t.timestamp)}).attr("cy",function(t){return t.avg?ot(t.avg):-9999999}).on("mouseover",function(t,e){lt.show(t,e)}).on("mouseout",function(){lt.hide()}),n.exit().remove()}function Z(){It=Date.now(),
Vt=moment().subtract(St,"seconds").valueOf(),A(Dt,Lt,Vt,It,60)}function Q(t){switch(t){case"rhqbar":H(!0);break;case"histogram":H(!1);break;case"line":M();break;case"hawkularmetric":console.info("DEPRECATION WARNING: The chart type hawkularmetric has been deprecated and will be removed in a future release. Please use the line chart type in its place"),M();break;case"multiline":I(et);break;case"area":V();break;case"scatter":$();break;case"scatterline":G();break;default:u.warn("chart-type is not valid. Must be in [rhqbar,line,area,multiline,scatter,scatterline,histogram] chart type: "+t)}}function tt(t){var e,n,a,r=0;if(0==t.length)return r;for(e=0,a=t.length;a>e;e++)n=t.charCodeAt(e),r=(r<<5)-r+n,r|=0;return r}var et,nt,at,rt,it,ot,st,ut,ct,lt,dt,ft,mt,pt,ht,vt,gt,xt,yt,At,wt,Ct,kt=250,bt=750,Tt="MM/DD/YYYY h:mm a",Ht=[],Dt=d.metricUrl,Lt=d.metricId||"",Rt=d.metricTenantId||"",Et=d.metricType||"gauge",St=+d.timeRangeInSeconds||43200,Nt=+d.refreshIntervalInSeconds||3600,_t=+d.alertValue,Mt=d.interpolation||"monotone",It=Date.now(),Vt=It-St,$t=[],Gt=[],Bt=d.chartType||"hawkularline",Ut=d.singleValueLabel||"Raw Value",Yt=d.noDataLabel||"No Data",Pt=d.durationLabel||"Interval",Ft=d.minLabel||"Min",zt=d.maxLabel||"Max",Xt=d.avgLabel||"Avg",Ot=d.timestampLabel||"Timestamp",Wt=!0,Jt=!1,jt=!1,Kt=!1,qt={top:10,right:5,bottom:5,left:90},Zt=bt-qt.left-qt.right,Qt=kt-50,te=Qt-qt.top-qt.bottom,ee=600,ne=30,ae=10,re=te+qt.top-ne-ae+qt.bottom,ie=+ne+ae+qt.top,oe=2,se=!1;Ht=d.data,Jt=d.showDataPoints,$t=d.previousRangeData,Gt=d.annotationData;var ue,ce=.6;c.$watchCollection("data",function(t){t&&(wt=angular.fromJson(t),c.render(wt,Ct))}),c.$watch("multiData",function(t){t&&(et=angular.fromJson(t),c.render(wt,Ct))},!0),c.$watch("previousRangeData",function(t){t&&(Ct=angular.fromJson(t),c.render(wt,Ct))},!0),c.$watch("annotationData",function(t){t&&(Gt=angular.fromJson(t),c.render(wt,Ct))},!0),c.$watchGroup(["alertValue","chartType","hideHighLowValues","useZeroMinValue","showAvgLine"],function(t){_t=t[0]||_t,Bt=t[1]||Bt,jt="undefined"!=typeof t[2]?t[2]:jt,Kt="undefined"!=typeof t[3]?t[3]:Kt,Wt="undefined"!=typeof t[4]?t[4]:Wt,c.render(wt,Ct)}),c.$watchGroup(["metricUrl","metricId","metricType","metricTenantId","timeRangeInSeconds"],function(t){Dt=t[0]||Dt,Lt=t[1]||Lt,Et=t[2]||Lt,Rt=t[3]||Rt,St=t[4]||St,Z()}),c.$watch("refreshIntervalInSeconds",function(t){t&&(Nt=+t,s.cancel(ue),ue=s(function(){Z()},1e3*Nt))}),c.$on("$destroy",function(){s.cancel(ue)}),c.$on("DateRangeDragChanged",function(t,e){c.$emit("GraphTimeRangeChangedEvent",e)}),c.render=function(t,n){(t||et)&&(e&&console.group("Render Chart"),e&&console.time("chartRender"),se||h(),t&&g(t),et&&y(et),_t&&_t>gt&&xt>_t&&W(O(nt,_t)),J(),B(),Q(Bt),Jt&&q(nt),j(n),U(),Wt&&F(),_t&&_t>gt&&xt>_t&&X(_t),Gt&&K(Gt),e&&console.timeEnd("chartRender"),e&&console.groupEnd("Render Chart"))}}return{link:c,restrict:"E",replace:!0,scope:{data:"=",multiData:"=",metricUrl:"@",metricId:"@",metricType:"@",metricTenantId:"@",startTimestamp:"@",endTimestamp:"@",timeRangeInSeconds:"@",refreshIntervalInSeconds:"@",previousRangeData:"@",annotationData:"@",showDataPoints:"=",alertValue:"@",interpolation:"@",chartType:"@",yAxisUnits:"@",useZeroMinValue:"=",chartHoverDateFormat:"@",chartHoverTimeFormat:"@",singleValueLabel:"@",noDataLabel:"@",durationLabel:"@",minLabel:"@",maxLabel:"@",avgLabel:"@",timestampLabel:"@",showAvgLine:"=",hideHighLowValues:"="}}}])}(Charts||(Charts={}));var Charts;!function(t){"use strict";var e=25,n=angular.module("hawkular.charts"),a=function(){function t(n){var a=this;this.restrict="E",this.replace=!0,this.scope={data:"=",showYAxisValues:"=",showXAxisValues:"="},this.link=function(n,r,i){function o(){g&&x.selectAll("*").remove(),x=d3.select(r[0]),g=x.append("svg").attr("width",C+A.left+A.right).attr("height",b).attr("viewBox","0 0 "+(C+A.left+A.right)+" "+(k+A.top+A.bottom+e)).attr("preserveAspectRatio","xMinYMin meet"),y=g.append("g").attr("transform","translate("+A.left+","+A.top+")")}function s(e){console.log("dataPoints.length: "+e.length),p=d3.time.scale().range([0,C-10]).domain([e[0].timestamp,e[e.length-1].timestamp]);var n=c?5:0;h=d3.svg.axis().scale(p).ticks(n).tickSize(4,0).orient("bottom"),y.selectAll("g.axis").remove(),v=y.append("g").attr("class","x axis").attr("transform","translate(0,"+k+")").call(h);var a=d3.min(e,function(t){return t.avg}),r=d3.max(e,function(t){return t.avg});r+=.03*r,a-=.05*a,d=d3.scale.linear().rangeRound([t._CHART_HEIGHT,0]).domain([a,r]);var i=l?3:0;f=d3.svg.axis().scale(d).ticks(i).tickSize(4,0).orient("left"),m=y.append("g").attr("class","y axis").call(f);var o="basis",s=d3.svg.area().interpolate(o).defined(function(t){return!t.empty}).x(function(t){return p(t.timestamp)}).y0(function(e){return t._CHART_HEIGHT-15}).y1(function(t){return d(t.avg)}),u=d3.svg.line().interpolate(o).defined(function(t){return!t.empty}).x(function(t){return p(t.timestamp)}).y(function(t){return d(t.avg)}),g=y.selectAll("path.sparklineLine").data([e]);g.attr("class","sparklineLine").transition().attr("d",u),g.enter().append("path").attr("class","sparklineLine").transition().attr("d",u),g.exit().remove();var x=y.append("g").attr("class","sparkline");x.append("path").datum(e).transition().duration(500).attr("class","sparklineArea").attr("d",s)}function u(t){return t?t.map(function(t){var e=t.timestamp||t.start+(t.end-t.start)/2;return{timestamp:e,value:angular.isNumber(t.value)?t.value:void 0,avg:t.empty?void 0:t.avg,min:angular.isNumber(t.min)?t.min:void 0,max:angular.isNumber(t.max)?t.max:void 0,empty:t.empty}}):void 0}var c,l,d,f,m,p,h,v,g,x,y,A={top:10,right:5,bottom:5,left:35},w=t._CHART_HEIGHT,C=t._CHART_WIDTH-A.left-A.right,k=w-A.top-A.bottom,b=k+A.top;"undefined"!=typeof i.showXAxisValues&&(c="true"===i.showXAxisValues),"undefined"!=typeof i.showYAxisValues&&(l="true"===i.showYAxisValues),n.$watchCollection("data",function(t){console.log("Sparkline Chart Data Changed"),t&&(a.dataPoints=u(angular.fromJson(t)),n.render(a.dataPoints))}),n.render=function(t){t&&t.length>0&&(console.group("Render Sparkline Chart"),console.time("SparklineChartRender"),o(),s(t),console.timeEnd("SparklineChartRender"),console.groupEnd())}}}return t.Factory=function(){var e=function(e){return new t(e)};return e.$inject=["$rootScope"],e},t._CHART_WIDTH=300,t._CHART_HEIGHT=80,t}();t.SparklineChartDirective=a,n.directive("hawkularSparklineChart",a.Factory())}(Charts||(Charts={}));